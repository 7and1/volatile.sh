# volatile.sh - Zero-Knowledge Secret Sharing
# Cloudflare Workers Configuration Template
#
# SETUP INSTRUCTIONS:
# 1. Copy this file: cp wrangler.toml.example wrangler.toml
# 2. Set environment variable: export CLOUDFLARE_ACCOUNT_ID="your_account_id"
# 3. Create KV namespaces (see comments below)
# 4. Update KV namespace IDs in wrangler.toml
# 5. Deploy: npm run deploy

name = "volatile-sh"
main = "src/index.js"
compatibility_date = "2024-12-01"

# NOTE: account_id is NOT specified here for security
# Set via environment variable: CLOUDFLARE_ACCOUNT_ID
# Or pass via CLI: wrangler deploy --account-id YOUR_ACCOUNT_ID

# Workers.dev domain (enabled by default for development)
workers_dev = true

# Serve static files from /dist (built frontend)
[assets]
directory = "./dist"

# KV namespace for security data (IP blacklist, etc.)
# Create with: wrangler kv namespace create "SECURITY_KV"
[[kv_namespaces]]
binding = "SECURITY_KV"
id = "YOUR_KV_NAMESPACE_ID"

# Durable Object bindings for stateful storage
[[durable_objects.bindings]]
name = "SECRETS"
class_name = "SecretStore"

[[durable_objects.bindings]]
name = "RATE_LIMIT"
class_name = "RateLimiter"

# Durable Object migrations (required for first deploy)
[[migrations]]
tag = "v1"
new_classes = ["SecretStore"]

[[migrations]]
tag = "v2"
new_classes = ["RateLimiter"]

# Environment variables
[vars]
ENVIRONMENT = "development"

# ============================================================================
# STAGING ENVIRONMENT - Deploy with: wrangler deploy --env staging
# ============================================================================
[env.staging]
name = "volatile-sh-staging"
workers_dev = true

[env.staging.vars]
ENVIRONMENT = "staging"
LOG_LEVEL = "debug"

[[env.staging.kv_namespaces]]
binding = "SECURITY_KV"
id = "YOUR_STAGING_KV_NAMESPACE_ID"

# Durable Objects must be defined per environment
[[env.staging.durable_objects.bindings]]
name = "SECRETS"
class_name = "SecretStore"

[[env.staging.durable_objects.bindings]]
name = "RATE_LIMIT"
class_name = "RateLimiter"

[[env.staging.migrations]]
tag = "v1"
new_classes = ["SecretStore"]

[[env.staging.migrations]]
tag = "v2"
new_classes = ["RateLimiter"]

# ============================================================================
# PRODUCTION ENVIRONMENT - Deploy with: wrangler deploy --env production
# ============================================================================
[env.production]
name = "volatile-sh"
workers_dev = true

[env.production.vars]
ENVIRONMENT = "production"
LOG_LEVEL = "warn"

[[env.production.kv_namespaces]]
binding = "SECURITY_KV"
id = "YOUR_PRODUCTION_KV_NAMESPACE_ID"

# Durable Objects must be defined per environment
[[env.production.durable_objects.bindings]]
name = "SECRETS"
class_name = "SecretStore"

[[env.production.durable_objects.bindings]]
name = "RATE_LIMIT"
class_name = "RateLimiter"

[[env.production.migrations]]
tag = "v1"
new_classes = ["SecretStore"]

[[env.production.migrations]]
tag = "v2"
new_classes = ["RateLimiter"]
